#!/usr/bin/env python
import sys
import getopt

from stat_dashboard_pipeline import Pipeline


class StatPipeline():
    def __init__(self):
        self.pipeline = Pipeline()

    def run(self):
        self.pipeline.run()

    def migrate(self):
        self.pipeline.migrate()


def main():
    """

    Run:
    stat_pipeline

    Command Line options:
    --migrate / -m
        Run a full migration of historical data to temporary
        CSV files for uploading to Socrata via UI

    """
    unix_options = ":m"
    gnu_options = ["migrate"]
    cmd_args = sys.argv
    arguments = cmd_args[1:]

    try:
        args, vals = getopt.getopt(arguments, unix_options, gnu_options)
    except getopt.error as err:
        # Return with an error code
        print(str(err))
        sys.exit(2)
    stat_pipeline = StatPipeline()

    for arg in args:
        if arg[0] in ("-m", "--migrate"):
            print("[STAT PIPELINE] Migrating")
            stat_pipeline.migrate()
            return

    # Standard run
    print("[STAT PIPELINE] Running")
    stat_pipeline.run()
    return


if __name__ == '__main__':
    sys.exit(main())
